(function(){function iosConnect(callback){if(window.MagAndroidClient){return}if(window.WebViewJavascriptBridge){return callback(WebViewJavascriptBridge)}else{document.addEventListener("WebViewJavascriptBridgeReady",function(evt){callback(WebViewJavascriptBridge)},false)}if(window.WVJBCallbacks){return window.WVJBCallbacks.push(callback)}else{window.WVJBCallbacks=[callback];var WVJBIframe=document.createElement("iframe");WVJBIframe.style.display="none";WVJBIframe.src="https://__bridge_loaded__";document.documentElement.appendChild(WVJBIframe);setTimeout(function(){document.documentElement.removeChild(WVJBIframe)},0)}}iosConnect(function(bridge){if(bridge.init&&typeof bridge.init==="function"){bridge.init(function(message,responseCallback){})}bridge.registerHandler("jsCallBack",function(data,responseCallback){var call=JSON.parse(data);var id=call.id;var val=call.val;var callback=mag.callbacks[id];if(callback){if(callback.type&&callback.type=="json"){if(val){val=JSON.parse(val)}}callback.success(val)}})});mag={VERSION:"1.1",ready:function(fun){iosConnect(function(){fun()});if(window.MagAndroidClient){fun()}},callbacks:{},iosConnect:iosConnect,jsCallBack:function(id,val){var callback=mag.callbacks[id];if(callback){if(callback.type&&callback.type=="json"){if(val){val=JSON.parse(val)}}callback.success(val)}},getLocation:function(fun){if(!fun){return}mag.callbacks.getLocation={type:"json",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.getLocation()}iosConnect(function(bridge){bridge.callHandler("getLocation","",function(rs){})})},mapPick:function(fun){if(!fun){return}mag.callbacks.mapPick={type:"json",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.mapPick()}iosConnect(function(bridge){bridge.callHandler("mapPick","",function(){})})},closeWin:function(){if(window.MagAndroidClient){window.MagAndroidClient.closeWin()}iosConnect(function(bridge){bridge.callHandler("closeWin","",function(rs){})})},previewImage:function(config){var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.previewImage(configStr)}iosConnect(function(bridge){bridge.callHandler("previewImage",configStr,function(rs){})})},picPick:function(config){mag.callbacks.picPickPreview={type:"json",success:config.preview};mag.callbacks.picPickSuccess={type:"json",success:config.success};mag.callbacks.picPickFail={type:"json",success:config.fail};var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.picPick(configStr)}iosConnect(function(bridge){bridge.callHandler("picPick",configStr,function(rs){})})},camera:function(config){mag.callbacks.cameraPreview={type:"json",success:config.preview};mag.callbacks.cameraSuccess={type:"json",success:config.success};mag.callbacks.cameraFail={type:"json",success:config.fail};var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.camera(configStr)}iosConnect(function(bridge){bridge.callHandler("camera",configStr,function(rs){})})},setData:function(config){var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.setData(configStr)}iosConnect(function(bridge){bridge.callHandler("setData",configStr,function(rs){})})},share:function(platform,success,fail){mag.callbacks.shareSuccess={type:"",success:success};mag.callbacks.shareFailed={type:"",success:fail};if(window.MagAndroidClient){window.MagAndroidClient.share(platform)}iosConnect(function(bridge){bridge.callHandler("share",platform,function(rs){})})},shareCard:function(config,success,fail){mag.callbacks.shareSuccess={type:"",success:success};mag.callbacks.shareFailed={type:"",success:fail};var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.shareCard(configStr)}iosConnect(function(bridge){bridge.callHandler("shareCard",configStr,function(rs){})})},socialBind:function(platform,success,fail){mag.callbacks.bindOnSuccess={type:"json",success:success};mag.callbacks.bindOnFail={type:"json",success:fail};if(window.MagAndroidClient){window.MagAndroidClient.socialBind(platform)}iosConnect(function(bridge){bridge.callHandler("socialBind",platform,function(rs){})})},report:function(config){var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.report(configStr)}iosConnect(function(bridge){bridge.callHandler("report",configStr,function(rs){})})},scanQR:function(fun){if(!fun){return}mag.callbacks.scanQR={type:"",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.scanQR()}iosConnect(function(bridge){bridge.callHandler("scanQR","",function(rs){})})},actionSheet:function(config,fun){if(!fun){return}var configStr=JSON.stringify(config);mag.callbacks.actionSheet={type:"json",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.actionSheet(configStr)}iosConnect(function(bridge){bridge.callHandler("actionSheet",configStr,function(rs){})})},toast:function(text){if(window.MagAndroidClient){window.MagAndroidClient.toast(text)}iosConnect(function(bridge){bridge.callHandler("toast",text,function(rs){})
})},dialog:function(config){var configStr=JSON.stringify(config);mag.callbacks.dialogSuccess={type:"json",success:config.success};mag.callbacks.dialogCancel={type:"json",success:config.cancel};if(window.MagAndroidClient){window.MagAndroidClient.dialog(configStr)}iosConnect(function(bridge){bridge.callHandler("dialog",configStr,function(rs){})})},progress:function(){if(window.MagAndroidClient){window.MagAndroidClient.progress()}iosConnect(function(bridge){bridge.callHandler("progress","",function(rs){})})},hideProgress:function(){if(window.MagAndroidClient){window.MagAndroidClient.hideProgress()}iosConnect(function(bridge){bridge.callHandler("hideProgress","",function(rs){})})},setTitle:function(title){if(window.MagAndroidClient){window.MagAndroidClient.setTitle(title)}iosConnect(function(bridge){bridge.callHandler("setTitle",title,function(rs){})})},showNavigation:function(){if(window.MagAndroidClient){window.MagAndroidClient.showNavigation()}iosConnect(function(bridge){bridge.callHandler("showNavigation","",function(rs){})})},hideNavigation:function(){if(window.MagAndroidClient){window.MagAndroidClient.hideNavigation()}iosConnect(function(bridge){bridge.callHandler("hideNavigation","",function(rs){})})},setNavigationColor:function(color){if(window.MagAndroidClient){window.MagAndroidClient.setNavigationColor(color)}iosConnect(function(bridge){bridge.callHandler("setNavigationColor",color,function(rs){})})},hideMore:function(){if(window.MagAndroidClient){window.MagAndroidClient.hideMore()}iosConnect(function(bridge){bridge.callHandler("hideMore","",function(rs){})})},showMore:function(){if(window.MagAndroidClient){window.MagAndroidClient.showMore()}iosConnect(function(bridge){bridge.callHandler("showMore","",function(rs){})})},tel:function(phone){if(window.MagAndroidClient){window.MagAndroidClient.tel(phone)}iosConnect(function(bridge){bridge.callHandler("tel",phone,function(rs){})})},sms:function(phone,content){var configStr=JSON.stringify({phone:phone,content:content});if(window.MagAndroidClient){window.MagAndroidClient.sms(configStr)}iosConnect(function(bridge){bridge.callHandler("sms",configStr,function(rs){})})},toLogin:function(fun){mag.callbacks.loginSuccess={type:"json",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.toLogin()}iosConnect(function(bridge){bridge.callHandler("toLogin","",function(rs){})})},toUserHome:function(uid){if(window.MagAndroidClient){window.MagAndroidClient.toUserHome(uid)}iosConnect(function(bridge){bridge.callHandler("toUserHome",uid,function(rs){})})},addRedPacket:function(data){if(window.MagAndroidClient){window.MagAndroidClient.addRedPacket(data)}iosConnect(function(bridge){bridge.callHandler("addRedPacket",data,function(rs){})})},toUserHomeByName:function(username){if(!username){return}if(window.MagAndroidClient){window.MagAndroidClient.toUserHomeByName(username)}iosConnect(function(bridge){bridge.callHandler("toUserHomeByName",username,function(rs){})})},commentBar:function(config){var configStr=JSON.stringify(config);if(config.onComment){mag.callbacks.commentBar={type:"json",success:config.onComment}}if(config.onCommentShow){mag.callbacks.onCommentShow={type:"",success:config.onCommentShow}}if(config.onPageSelect){mag.callbacks.pageSelect={type:"json",success:config.onPageSelect}}if(config.onApplaud){mag.callbacks.applaud={type:"json",success:config.onApplaud}}if(window.MagAndroidClient){window.MagAndroidClient.commentBar(configStr)}iosConnect(function(bridge){bridge.callHandler("commentBar",configStr,function(rs){})})},toComment:function(config){var configStr=JSON.stringify(config);if(config.success){mag.callbacks.comment={type:"json",success:config.success}}if(window.MagAndroidClient){window.MagAndroidClient.toComment(configStr)}iosConnect(function(bridge){bridge.callHandler("toComment",configStr,function(rs){})})},newWin:function(page,params){if(page.indexOf("?")<0){page+="?"}for(var key in params){page+="&"+key+"="+params[key]}if(window.MagAndroidClient){window.MagAndroidClient.newWin(page)}iosConnect(function(bridge){bridge.callHandler("newWin",page,function(rs){})})},setPageLife:function(life){mag.callbacks.pageAppear={type:"",success:life.pageAppear};mag.callbacks.pageDisappear={type:"",success:life.pageDisappear}},followAuthorFromNative:function(options){mag.callbacks.followAuthorFromNative={type:"",success:options.followAuthorFromNative}},availableSharePlatform:function(options){mag.callbacks.availableSharePlatform={type:"json",success:options.availableSharePlatform};if(window.MagAndroidClient){window.MagAndroidClient.availableSharePlatform()}iosConnect(function(bridge){bridge.callHandler("availableSharePlatform","",function(rs){})})},pay:function(config,success,fail){mag.callbacks.payOnSuccess={type:"",success:success};mag.callbacks.payOnFail={type:"",success:fail};var configstr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.pay(configstr)}iosConnect(function(bridge){bridge.callHandler("pay",configstr,function(rs){})
})},alipay:function(datastr,success,fail){if(!datastr){return false}mag.callbacks.alipayOnSuccess={type:"",success:success};mag.callbacks.alipayOnFail={type:"",success:fail};if(window.MagAndroidClient){window.MagAndroidClient.alipay(datastr)}iosConnect(function(bridge){bridge.callHandler("alipay",datastr,function(rs){})})},inAppPay:function(config,success,fail){mag.callbacks.inAppPaySuccess={type:"",success:success};mag.callbacks.inAppPayOnFail={type:"",success:fail};var configstr=JSON.stringify(config);iosConnect(function(bridge){bridge.callHandler("inAppPay",configstr,function(rs){})})},deviceLogin:function(fun){mag.callbacks.loginSuccess={type:"json",success:fun};iosConnect(function(bridge){bridge.callHandler("deviceLogin","",function(rs){})})},phoneBind:function(success){mag.callbacks.phoneBindSuccess={type:"string",success:success};if(window.MagAndroidClient){window.MagAndroidClient.phoneBind()}iosConnect(function(bridge){bridge.callHandler("phoneBind","",function(rs){})})},qqConnectLogin:function(token){if(window.MagAndroidClient){window.MagAndroidClient.qqConnectLogin(token)}iosConnect(function(bridge){bridge.callHandler("qqConnectLogin",token,function(rs){})})},bounceEnable:function(enableOrNot){iosConnect(function(bridge){bridge.callHandler("bounceEnable",enableOrNot,function(rs){})})},showNaviAuthor:function(){if(window.MagAndroidClient){window.MagAndroidClient.showNaviAuthor()}iosConnect(function(bridge){bridge.callHandler("showNaviAuthor","",function(rs){})})},hideNaviAuthor:function(){if(window.MagAndroidClient){window.MagAndroidClient.hideNaviAuthor()}iosConnect(function(bridge){bridge.callHandler("hideNaviAuthor","",function(rs){})})},followAuthorFromWeb:function(is_fans){if(window.MagAndroidClient){window.MagAndroidClient.followAuthorFromWeb(is_fans)}iosConnect(function(bridge){bridge.callHandler("followAuthorFromWeb",is_fans,function(rs){})})},setSwipeBackDisable:function(){if(window.MagAndroidClient){window.MagAndroidClient.setSwipeBackDisable()}iosConnect(function(){bridge.callHandler("setSwipeBackDisable",function(rs){})})},setSwipeBackEnable:function(){if(window.MagAndroidClient){window.MagAndroidClient.setSwipeBackEnable()}iosConnect(function(){bridge.callHandler("setSwipeBackEnable",function(rs){})})},addRefreshComponent:function(){if(window.MagAndroidClient){window.MagAndroidClient.addRefreshComponent()}iosConnect(function(bridge){bridge.callHandler("addRefreshComponent","",function(rs){})})},sappHome:function(url){if(window.MagAndroidClient){window.MagAndroidClient.sappHome(url)}iosConnect(function(bridge){bridge.callHandler("sappHome",url,function(rs){})})},chat:function(config){var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.chat(configStr)}iosConnect(function(bridge){bridge.callHandler("chat",configStr,function(rs){})})},newExternalWin:function(config){var configStr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.newExternalWin(configStr)}iosConnect(function(bridge){bridge.callHandler("newExternalWin",configStr,function(rs){})})},getAppAuthKey:function(fun){if(!fun){return}mag.callbacks.getAppAuthKey={type:"json",success:fun};if(window.MagAndroidClient){window.MagAndroidClient.getAppAuthKey()}iosConnect(function(bridge){bridge.callHandler("getAppAuthKey","",function(rs){})})},sendGift:function(config,success){var configstr=JSON.stringify(config);mag.callbacks.giftSendSuccess={type:"json",success:success};if(window.MagAndroidClient){window.MagAndroidClient.sendGift(configstr)}iosConnect(function(bridge){bridge.callHandler("sendGift",configstr,function(rs){})})},showPhoneSettings:function(){iosConnect(function(bridge){bridge.callHandler("showPhoneSettings","",function(rs){})})},getNotificationStatus:function(success){mag.callbacks.getNotificationStatus={type:"string",success:success};iosConnect(function(bridge){bridge.callHandler("getNotificationStatus","",function(rs){})})},downloadAttachment:function(config){var configstr=JSON.stringify(config);if(window.MagAndroidClient){window.MagAndroidClient.downloadAttachment(configstr)}iosConnect(function(bridge){bridge.callHandler("downloadAttachment",configstr,function(rs){})})},getNetworkState:function(success){mag.callbacks.getNetworkState={type:"string",success:success},window.MagAndroidClient&&window.MagAndroidClient.getNetworkState(),iosConnect(function(bridge){bridge.callHandler("getNetworkState","",function(n){})})},getDeviceId:function(success){mag.callbacks.getDeviceId={type:"string",success:success};if(window.MagAndroidClient){window.MagAndroidClient.getDeviceId()}iosConnect(function(bridge){bridge.callHandler("getDeviceId","",function(rs){})})}};window.mag=mag})();
