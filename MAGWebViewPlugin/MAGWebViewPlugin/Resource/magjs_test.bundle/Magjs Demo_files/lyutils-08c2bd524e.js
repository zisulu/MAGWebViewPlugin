!function(e){"use strict";var n=e,t=function(){var e=window.navigator.appVersion.toLowerCase(),n={isIOS:-1!=e.indexOf("mac os x"),isAndroid:-1!=e.indexOf("android"),isInMagappX:-1!=e.indexOf("magappx"),isWx:-1!=e.indexOf("micromessenger")},t=function(){var e=window.location.search,n=/^\?+/g,t={};if(e){var i=e.match(n).toString(),o=e.replace(i,""),a=o.split("&");for(var r in a){var s=a[r],l=s.split("=");t[l[0]]=l[1]}}return t},i=function(e){var n=document,e=e||"42BD56",t=n.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=".theme-font-color{color:#"+e+";}.theme-bg-color{ background-color:#"+e+";}.theme-border-color{ border-color:#"+e+";}",n.getElementsByTagName("head")[0].appendChild(t)},o=null,a=function(e){o?e(o):$.get("/mag/index/v1/Index/jsApi",function(n){o=n,e(o)})},r={logined:function(e){a(function(n){var t=n._USER;parseInt(t.user_id)>0?e(n._USER):mag.toLogin(function(){window.location.reload()})})}},s=function(e,n){var t=new Image;if(t.src=e,t.complete)return void("function"==typeof n&&n(t));t.onload=function(){"function"==typeof n&&n(t)}},l=function(){var e=window.navigator.userAgent.toLowerCase(),n=!1;return-1==e.indexOf("micromessenger")&&-1==e.indexOf("qq/")&&-1==e.indexOf("weibo")||(n=!0),n},c=function(e,n){l()?n&&n():e&&e()},d=function(e){l()?"undefined"!=typeof layer?layer.open({content:e,skin:"msg",time:2}):alert(e):"undefined"!=typeof mag?mag.toast(e):alert(e)},u={},p="",f=function(e){return u[e]?u[e]:(p||(p=$.ajax({url:"/public/static/components/mobile.html?time="+(new Date).getTime(),dataType:"html",async:!1}).responseText),u[e]=$("<html></html>").append(p).find("#"+e).get(0).innerHTML,u[e])},m=function(e){return document.getElementById(e).innerHTML},g=function(e){for(var e=e||$(".html-data"),t=window.location.origin,i=e.find("img"),o=[],a=e.find(".img-posted"),r=0,s=0,l=i.length;s<l;s++){var c=i.eq(s).attr("data-original")||"";c||(c=i.eq(s).attr("src")),0!==c.indexOf("http")&&(c=t+c),i.eq(s).attr("data-original",c),i.eq(s).hasClass("img-emoj")||(o.push(c),i.eq(s).attr("data-index",r),r++)}var d=0;$(window).on("scroll",function(){d=$(this).scrollTop()}),i.on("click",function(){if(d==$(window).scrollTop()){if($(this).hasClass("img-emoj"))return;var e,t=$(this).attr("src");e=$(this).attr("data-index"),n.isInMagappX?mag.previewImage({current:e,pics:o}):"undefined"!=typeof wx&&wx.previewImage({current:t,urls:o})}}),a.lazyload({load:function(e){}}).on("load",function(){$(this).addClass("loaded")})},h=function(e){if(e.length){for(var n=e.find(".img-posted"),t=[],i=0;i<n.length;i++){var o=n.eq(i).data("original");0!==o.indexOf("http")&&(o=window.location.origin+o,n.eq(i).data("original",o)),t.push(o),n[i].src=o,n[i].className+=" loaded",n.eq(i).attr("pindex",i)}var a=0;$(window).on("scroll",function(){a=$(this).scrollTop()}),n.on("click",function(){a==$(window).scrollTop()&&mag.previewImage({current:parseInt($(this).attr("pindex")),pics:t})})}},w=function(e){for(var n=e.find("img"),t=[],i=0,o=0,a=n.length;o<a;o++)n.eq(o).hasClass("img-emoj")||(t.push(n.eq(o).attr("src")),n.eq(o).attr("data-index",i),i++);n.on("click",function(){if(!$(this).hasClass("img-emoj")){var e;$(this).attr("src");e=$(this).attr("data-index"),mag.previewImage({current:e,pics:t})}})},y=function(e){var n=e.title,t=e.desc,i=e.link||window.location.href,o=e.shareimg;$.get("/mag/user/v1/wxwap/getSignPackage",{url:location.href.split("#")[0]},function(e){e.success&&(wx.config({appId:e.data.appId,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","previewImage","scanQRCode"]}),wx.ready(function(){wx.onMenuShareTimeline({title:n,link:i,imgUrl:o}),wx.onMenuShareAppMessage({title:n,desc:t,link:i,imgUrl:o})}),wx.error(function(e){alert("对接公众平台出错："+JSON.stringify(e))}))},"json")},v=function(e,n){mag.dialog({title:"提示",content:e||"参与更多互动，请先绑定手机号",buttons:["取消","去绑定"],success:function(){mag.phoneBind(function(e){n&&"function"==typeof n&&n(e)})}})},x=function(e,t,i,o){if(console.log(e),e&&t){var o=o||"https://api.magcloud.cc",a=encodeURIComponent(window.location.href),r=encodeURIComponent(e),s=o+"/magshare/"+t+"?content_url="+a+"&jump_url="+r;T(r),l()?window.location.href=n.isAndroid?i:s+"&client_type=1":$(".app-jump-overlay").fadeIn("fast")}},T=function(e){var n=document.createElement("input");n.value=e,n.setAttribute("style","position:fixed;top:0;"),document.body.appendChild(n),n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("Copy"),document.body.removeChild(n)},I=function(e){if(!e.length)return!1;_.each(e,function(e){var n=e.innerHTML,t=/^1[34578]\d{9}$/,i=/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/,o=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;(t.test(n)||i.test(n))&&(e.innerHTML='<a class="link-jump" href="tel:'+n+'">'+n+"</a>"),o.test(n)&&(e.innerHTML='<a class="link-jump" href="mailto:'+n+'">'+n+"</a>")})},S={index:0,show:function(){l()?"undefined"!=typeof layer&&(this.index=layer.open({type:2,shadeClose:!1})):"undefined"!=typeof mag&&mag.progress()},hide:function(){l()?"undefined"!=typeof layer&&layer.close(this.index):"undefined"!=typeof mag&&mag.hideProgress()}},C=function(e){$.ajaxSetup({timeout:3e4,dataType:"json",error:function(n,t,i){S.hide(),e.errorFn&&e.errorFn()},complete:function(){S.hide()}}),void 0!==e.type&&"POST"===e.type&&S.show(),$.ajax({type:e.type||"GET",url:e.url,data:e.data,success:function(n,t,i){e.success&&e.success(n)}})},b=function(e){return!e||e.indexOf("@")<0?e:e.replace(/@[^ |^\n|^：]+ /g,function(e){var n=e.replace(/@/g,"");return'<span class="hooker-at-user link-jump" data-username="'+(n=$.trim(n))+'">'+e+"</span>"})},A=function(e){for(var t=e.width()/(4/3),i=e.find(".mag-video"),o=e.find("iframe"),a=0;a<o.length;a++)o[a].hasAttribute("allowfullscreen")&&o.eq(a).css("height",t+"px");i.length&&(i.attr("preload","auto"),i.each(function(e,n){$(n).wrap('<div class="video-player" style="height:'+t+'px;"></div>'),$(n).addClass("loaded")}),n.isIOS?i.each(function(e,n){$(n).after('<span class="icon-play"></span>');var t=$(n)[0],i=$(n).siblings(".icon-play")[0];i.onclick=function(){t.paused&&(t.setAttribute("controls",!0),t.play(),i.style.display="none")},t.addEventListener("pause",function(){t.setAttribute("controls",!1),i.style.display="inline"}),t.addEventListener("play",function(){t.setAttribute("controls",!0),i.style.display="none"})}):i.attr("controls",!0))};return{locationSearchParser:t,filterAnchorLink:function(e){},appendThemeColorStyleNode:i,GetGlobalConfig:a,userAction:r,preloadImage:s,pageIsInThirdPlatform:l,getHtml:f,getHtmlByDoc:m,imageLazyload:g,imageDelaySetSrcInMagX:h,showImagePreview:w,acrossPlatformFns:c,acrossPlatformToast:d,configPageInWeixin:y,clientSystemType:n,goBindPhonePage:v,jumpToAppPage:x,filterSpecialLinks:I,magHttp:C,filterAtUser:b,customVideoTag:A}}();n.ModsUtil||(n.ModsUtil=t);var i=t.locationSearchParser().themecolor;t.appendThemeColorStyleNode(i),n.GlobalConstants={ErrorCodeNoBindPhone:1004,ApiJumpAppDownload:"/mag/index/v1/index/shareDownload"}}(window);